{%  extends "base.html" %}


{% block content  %}

<head>
	<!-- Load plotly.js into the DOM -->
	<script src='https://cdn.plot.ly/plotly-latest.min.js'>
    </script>
</head>

<body>
<!-- Shows name of file currently in use at top of page-->
{% if error_message %}
    <p style="color:red;"> {{ error_message }} </p>
{% else %}
    <p style="color:green;"> {{log_name}} is used as input.</p>
{% endif %}

<!-- Dropdown menu selections -->
<br>
<div class="row">
  <div class=" col-sm-6 col-md-7 col-lg-8">
    <form  name="choice" action="" method = "POST">
      {% csrf_token %}
        <p>X-axis:</p>
        <select name="xaxis_choice">

          {% if default_label_list %}
            {% for attr in attribute_list %}
              {% if attr ==  default_label_list.0 %}
                <option value="{{attr}}" selected>{{attr}}</option>
              {% else %}
                <option value="{{attr}}">{{attr}}</option>
              {% endif %}
            {% endfor %}
          {% endif %}

          {% if label_list %}
            {% for attr in attribute_list %}
              {%if attr == label_list.0 %}
                <option value="{{attr}}" selected>{{attr}}</option>
              {% else %}}
                <option value="{{attr}}">{{attr}}</option>
              {% endif %}
            {% endfor %}
          {% endif %}

        </select>

        <p>Y-axis:</p>
        <select name="yaxis_choice">
          {% if default_label_list %}
            {% for attr in attribute_list %}
              {% if attr ==  default_label_list.1 %}
                <option value="{{attr}}" selected>{{attr}}</option>
              {% else %}
                <option value="{{attr}}">{{attr}}</option>
              {% endif %}
            {% endfor %}
          {% else %}}
            {% for attr in attribute_list %}
              {%if attr == label_list.1 %}
                <option value="{{attr}}" selected>{{attr}}</option>
              {% else %}}
                <option value="{{attr}}">{{attr}}</option>
              {% endif %}
            {% endfor %}
          {% endif %}
        </select>

        <p>Color:</p>
        <select name="color_choice">
          {% if default_label_list %}
            <option selected hidden>Choose here</option>
            {% for attr in attribute_list %}
             <option value="{{attr}}">{{attr}}</option>
            {% endfor %}
          {% else %}
            {% if label_list.2 == "Choose here" %}
                <option selected hidden>Choose here</option>
            {% endif %}
            {% for attr in attribute_list %}
              {% if attr == label_list.2 %}
                <option value="{{attr}}" selected>{{attr}}</option>
              {% else %}
                <option value="{{attr}}">{{attr}}</option>
              {% endif %}
            {% endfor %}
          {% endif %}

        </select>

        <p>Shape:</p>
        <select name="shape_choice">
          {% if default_label_list %}
            <option selected hidden>Choose here</option>
            {% for attr in attribute_list %}
             <option value="{{attr}}">{{attr}}</option>
            {% endfor %}
          {% else %}
            {% if label_list.3 == "Choose here" %}
                <option selected hidden>Choose here</option>
            {% endif %}
            {% for attr in attribute_list %}
              {% if attr == label_list.3 %}
                <option value="{{attr}}" selected>{{attr}}</option>
              {% else %}
                <option value="{{attr}}">{{attr}}</option>
              {% endif %}
            {% endfor %}
          {% endif %}

        </select>

      <br>
        <input style="margin-top: 10px;" data-toggle="tooltip" data-placement="top" title="Set as the input" type = "submit" class="btn btn-success" value = "Set" name= "setButton" id ='setButton' />
      <br>

        <label for="trace_sort">Sort Trace:</label>
        <select onchange="this.form.submit()" id="trace_sort" name="trace_sort">
          {% if default_label_list %}
            <option value = "default;log" selected hidden>Sort on original order of traces in log</option>
              <option value ="duration;log">Sort on duration of traces</option>
            {% for attr in case_level_attributes %}
                <option value="{{attr}};first"> Sort on {{attr}} of first event</option>
                <option value="{{attr}};last"> Sort on {{attr}} of last event</option>
            {% endfor %}
            {% for attr in log_level_attributes %}
                <option value="{{attr}};log"> Sort on {{attr}} of trace</option>
            {% endfor %}
          {% else %}
            {% if sort_attr == "default"%}
                <option value ="{{ sort_attr }};log" selected>Sort on original order of traces in log</option>
                <option value = "duration;log">Sort on duration of trace</option>
            {% elif sort_attr == "duration" %}
                <option value = "{{ sort_attr }};log" selected>Sort on duration of trace</option>
                <option value ="default;log">Sort on original order of traces in log</option>
            {% else %}
                <option value ="default;log" >Sort on original order of traces in log</option>
                <option value = duration;log">Sort on duration of trace</option>
            {% endif %}

            {% for attr in case_level_attributes %}
                 {% if attr == sort_attr %}
                      {% if attr_level == 'first' %}
                          <option value="{{ attr }};first" selected>Sort on {{ attr }} of first event</option>
                          <option value="{{ attr }};last" >Sort on {{ attr }} of last event</option>
                      {% else %}
                           <option value="{{ attr }};last" selected>Sort on {{ attr }} of last event</option>
                           <option value="{{ attr }};first">Sort on {{ attr }} of first event</option>
                      {% endif %}
                 {% else %}
                        <option value="{{ attr }};last">Sort on {{ attr }} of last event</option>
                        <option value="{{ attr }};first">Sort on {{ attr }} of first event</option>
                    {% endif %}
              {% endfor %}

            {% for attr in log_level_attributes %}
                {% if sort_attr == attr%}
                    <option value="{{ attr }};log" selected>Sort on {{ attr }} of log</option>
                {% endif %}
                    <option value = "{{ attr }};log">Sort on {{ attr }} of log</option>
              {% endfor %}
            {% endif %}
        </select>


    </form>
      </div>
</div>
<br>
<div id="tester"></div>
<script>

function drawDefault()
{
  var default_axis = {{ default_axis_list|safe }};
  var default_x = default_axis[0];
  var default_y = default_axis[1];
  var default_label = {{ default_label_list|safe}};
  var trace1 = {
    x: default_x,
    y: default_y,
    mode: 'markers',
    type: 'scatter',
    marker: { size: 12, shape: 'square' }
  };

  var data = [ trace1 ];

  /*var layout = {
      showlegend: false,
      xaxis: { "categoryorder": "array",
        "categoryarray":  [3,5,4,6,1,2], title: default_label[0]},
      yaxis: { type: 'category', title: default_label[1], automargin: true}};*/

    var default_axes_order = {{ default_axis_order |safe }}

    var layout = {
    showlegend: false,
    xaxis: {'type': 'category', 'categoryorder': 'array', 'categoryarray': default_axes_order[0] ,title: default_label[0] },
    yaxis: {'type': 'category','categoryorder': 'array', 'categoryarray': default_axes_order[1], title: default_label[1], automargin: true}
  };

  Plotly.react("tester", data, layout);
}
</script>

<script>
function drawSomething(){
  var axis_values = {{axis_list|safe}};
  var x_values = axis_values[0];
  var y_values = axis_values[1];
  var chosen = {{label_list|safe}};
  var legend_list = {{legend_list|safe}};
  var axes_order={{ axes_order|safe }}
  var legend_list_colors = legend_list[0];
  var legend_list_shapes = legend_list[1];
  var possible_colors =['rgb(255, 0, 0)','rgb(255, 128, 0)','rgb(255, 255, 0)',
    'rgb(128, 255, 0)','rgb(0, 255, 255)','rgb(0, 128, 255)','rgb(0, 0, 255)',
    'rgb(128, 0, 255)','rgb(255, 0, 255)','rgb(255, 0, 128)','rgb(128, 128, 128)'];

  var possible_shapes =[0,1,2,3,5,13,17,25];

  if((chosen[2]=="Choose here")&&(chosen[3]=="Choose here"))
  {
    var trace1 = {
      x: x_values,
      y: y_values,
      mode: 'markers',
      type: 'scatter',
      marker: {size: 12, color: possible_colors[5]},
      showlegend: false,
    };

    var data = [ trace1 ];
  }
  else if((chosen[2]!="Choose here")&&(chosen[3]=="Choose here"))
  {
    var data = [];
    for (var i = 0; i <= 7; ++i) {
      var j = {
        x: x_values[i],
        y: y_values[i],
        mode: 'markers',
        type: 'scatter',
        name: legend_list_colors[i],
        marker: { size: 12, color: possible_colors[i] }
      };
      data.push(j);
    }

    //var layout = {
    //  showlegend: true,
    //  xaxis: { /*type: 'category', */ /*"categoryorder": "array",
    //    "categoryarray":  [3,2,1,6,5,4],*/ title: chosen[0] },
    //  yaxis: { /*type: 'category', */ title: chosen[1], automargin: true}
    //};

  }
  else if((chosen[2]=="Choose here")&&(chosen[3]!="Choose here"))
  {
    var data = [];
    for (var i = 0; i <= 7; ++i) {
      var j = {
        x: x_values[i],//['a'],
        y: y_values[i],//['b'],
        mode: 'markers',
        type: 'scatter',
        name: legend_list_shapes[i],
        marker: {
          size: 12,
          color: possible_colors[5],
          symbol: possible_shapes[i],
          line: { color: 'rgb(255,255,255)', width: 1}
        }
      };
      data.push(j);
    }

    //var layout = {
    //  showlegend: true,
    //  xaxis: { /*type: 'date',*/ title: chosen[0] },
    //  yaxis: { /*type: 'category',*/ title: chosen[1], automargin: true}
    //};
  }
  else if((chosen[2]!="Choose here")&&(chosen[3]!="Choose here"))
  {
    var data = [];
    for (var i = 0; i <= (x_values.length-1); ++i) {
      var j = {
        x: x_values[i],//['a'],
        y: y_values[i],//['b'],
        mode: 'markers',
        type: 'scatter',
        name: legend_list_colors[Math.floor(i/(legend_list_shapes.length))] + ', ' + legend_list_shapes[i%(legend_list_shapes.length)],
        marker: {
          size: 12,
          color: possible_colors[Math.floor(i/(legend_list_shapes.length))],
          symbol: possible_shapes[i%(legend_list_shapes.length)],
          line: { color: 'rgb(255,255,255)', width: 1}
        }
      };
      data.push(j);
    }

    //var layout = {
    //  showlegend: true,
    //  xaxis: { /*type: 'date',*/ title: chosen[0] },
    //  yaxis: { /*type: 'category',*/ title: chosen[1], automargin: true}
    //};
  }
  if (chosen[0].includes("time"))
  {
    var layout = {
    showlegend: true,
    xaxis: {
      type: 'date',
      title: chosen[0],
      rangeselector: {
        buttons: [
        {
          count: 1,
          label: '1m',
          step: 'month',
          stepmode: 'backward'
        },
        {
          count: 6,
          label: '6m',
          step: 'month',
          stepmode: 'backward'
        },
        {
          count: 1,
          label: '1y',
          step: 'year',
          stepmode: 'backward'
        },
        {
          count: 5,
          label: '5y',
          step: 'year',
          stepmode: 'backward'
        },
        {step: 'all'}
        ]
	},
    },
    yaxis: { 'type': 'category','categoryorder': 'array', 'categoryarray': axes_order[1], title: chosen[1], automargin: true}
    };
    }
    else
    {
      var layout = {
      showlegend: true,
      xaxis: {'type': 'category', 'categoryorder': 'array', 'categoryarray': axes_order[0], title: chosen[0] },
      yaxis: { 'type': 'category','categoryorder': 'array', 'categoryarray': axes_order[1],title: chosen[1], automargin: true}
      };
    }

  Plotly.react("tester", data, layout)
}
</script>


{% if default_try == False %}

  <script>drawSomething();</script>
{% else %}
  <p>Default </p>
  <script>drawDefault();</script>
{% endif %}

</body>

    {% endblock %}
